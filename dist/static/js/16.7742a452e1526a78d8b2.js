webpackJsonp([16],{AfD3:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});t("UuFX");var i=t("J1XP"),a=(t("eqfM"),t("/QYm")),n=(t("9++/"),t("QhyB")),r=t("SpLM"),o=t("mQKa"),c=t("RRUT"),u=t("Cuxu");t("7+uW").a.use(i.a).use(a.a).use(n.a);var l={components:{MessageList:r.a,WriteMessageBox:o.a,WriteMessage:c.a},data:()=>({isShowWriteBox:!1,clientHeight:0,messageList:[],pageSize:20,pageNum:0,finished:!0,loading:!1}),created(){document.title="全部留言"},mounted(){this.clientHeight=document.body.clientHeight,this.getAlbumOrSectionMessage()},methods:{getAlbumOrSectionMessage(){if(!this.$route.query.albumId&&!this.$route.query.sectionId)return Object(a.a)("链接有误，请联系客服");this.$route.query.sectionId?this.getAllMessageBySectionId():this.getAllMessageByAlbumId()},sendMessage(e){this.messageList.unshift(e),this.isShowWriteBox=!1},switchPraise(e){this.messageList[e].isPraise=!this.messageList[e].isPraise,this.messageList[e].praiseUv=this.messageList[e].isPraise?this.messageList[e].praiseUv+1:this.messageList[e].praiseUv-1},async getAllMessageByAlbumId(){const e=await Object(u.b)(this.$route.query.albumId,this.pageNum,this.pageSize);if(!e||"fail"===e.type)return Object(a.a)("服务端错误");this.messageList=[...this.messageList,...e.data],e.data.length<this.pageSize?this.finished=!0:(this.pageNum+=1,this.finished=!1),this.loading=!1},async getAllMessageBySectionId(){const e=await Object(u.c)(this.$route.query.sectionId,this.pageNum,this.pageSize);if(!e||"fail"===e.type)return Object(a.a)("服务端错误");this.messageList=[...this.messageList,...e.data],e.data.length<this.pageSize?this.finished=!0:(this.pageNum+=1,this.finished=!1),this.loading=!1},clickMessageOverlay(e){e.clientY>this.clientHeight-130||(this.isShowWriteBox=!1)}}},g={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"total-message-container"},[t("div",{staticClass:"message-box"},[t("van-list",{attrs:{finished:e.finished,"finished-text":"没有更多了"},on:{load:e.getAllMessageByAlbumId},model:{value:e.loading,callback:function(s){e.loading=s},expression:"loading"}},[t("MessageList",{attrs:{messageList:e.messageList},on:{switchPraise:e.switchPraise}})],1)],1),e._v(" "),t("WriteMessageBox",{staticClass:"write-message-box",on:{click:function(s){e.isShowWriteBox=!0}}}),e._v(" "),t("van-overlay",{attrs:{show:e.isShowWriteBox},on:{click:e.clickMessageOverlay}},[e.isShowWriteBox?t("WriteMessage",{staticClass:"write-message",attrs:{sendType:"album"},on:{sendMessage:e.sendMessage}}):e._e()],1),e._v(" "),t("div",{staticClass:"bottom-block"})],1)},staticRenderFns:[]};var h=t("VU/8")(l,g,!1,function(e){t("Ggyv")},"data-v-69293962",null);s.default=h.exports},B0GA:function(e,s){},Ggyv:function(e,s){},RRUT:function(e,s,t){"use strict";t("MY4N");var i=t("0zAV"),a=(t("eqfM"),t("/QYm")),n=t("7+uW"),r=t("Cuxu");n.a.use(i.a).use(a.a);var o={data:()=>({message:""}),methods:{async sendMessage(){const e=await Object(r.e)({targetId:this.$route.query.sectionId?this.$route.query.sectionId:this.$route.query.albumId,type:this.$route.query.sectionId?"section":"album",albumId:this.$route.query.albumId,content:this.message});if(!e&&"fail"===e.type)return Object(a.a)("服务器错误，请联系客服");Object(a.a)("发送成功"),this.$emit("sendMessage",e.data)},toSendMessagePage(){this.$router.push({name:"send-message",query:{albumId:this.$route.query.albumId,message:this.message,sectionId:this.$route.query.sectionId||""}})}}},c={render:function(){var e=this,s=e.$createElement,i=e._self._c||s;return i("div",{staticClass:"write-message-container f-row-between"},[i("div",{staticClass:"editor"},[i("van-field",{ref:"textInput",attrs:{rows:"3",clearable:"",type:"textarea",placeholder:"写留言和大家互动吧"},model:{value:e.message,callback:function(s){e.message=s},expression:"message"}})],1),e._v(" "),i("div",{staticClass:"operator f-col-between-r"},[i("img",{attrs:{src:t("hBeZ"),alt:""},on:{click:e.toSendMessagePage}}),e._v(" "),i("p",{on:{click:e.sendMessage}},[e._v("\n      发送\n    ")])])])},staticRenderFns:[]};var u=t("VU/8")(o,c,!1,function(e){t("B0GA")},"data-v-a6feb68c",null);s.a=u.exports}});
//# sourceMappingURL=16.7742a452e1526a78d8b2.js.map